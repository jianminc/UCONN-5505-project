st4_crash = c(nrow(dat_2[dat_2$PDO==0,]),nrow(dat_2[dat_2$PDO>0,]),nrow(dat_2[dat_2$PDO==0,])+nrow(dat_2[dat_2$PDO>0,]))
sg4_crash = c(nrow(dat_3[dat_3$PDO==0,]),nrow(dat_3[dat_3$PDO>0,]),nrow(dat_3[dat_3$PDO==0,])+nrow(dat_3[dat_3$PDO>0,]))
st3_crash
st4_crash
st4_crash +st3_crash
st3_crash = c(nrow(dat_1[dat_1$PDO==0,]),nrow(dat_1[dat_1$PDO>0,]),nrow(dat_1[dat_1$PDO==0,])+nrow(dat_1[dat_1$PDO>0,]))
st4_crash = c(nrow(dat_2[dat_2$PDO==0,]),nrow(dat_2[dat_2$PDO>0,]),nrow(dat_2[dat_2$PDO==0,])+nrow(dat_2[dat_2$PDO>0,]))
sg4_crash = c(nrow(dat_3[dat_3$PDO==0,]),nrow(dat_3[dat_3$PDO>0,]),nrow(dat_3[dat_3$PDO==0,])+nrow(dat_3[dat_3$PDO>0,]))
total = st3_crash + st4_crash + sg4_crash
tbl <- data.frame(st3_crash,st4_crash,sg4_crash,total)
rownames(tbl) <- c('Safe',"Crash","total")
tbl
tbl[1,1]
tbl[3,4]
Q = 0
for (i in 1:2){
for (j in 1:3){
Q = Q + (tbl[i,j]-(tbl[i,4]*tbl[3,j]/tbl[3,4]))^2/(tbl[i,4]*tbl[3,j]/tbl[3,4])
}
}
Q
Q >= qchisq(0.95,df=(2*1))
st3_ka = dat_1$KA
st4_ka = dat_2$KA
sg4_ka = dat_3$KA
X <- data.frame(value = data.matrix(st3_ka), label = "st3")
Y <- data.frame(value = data.matrix(st4_ka), label = "st4")
data_XY <- rbind(X,Y)[order(rbind(X,Y)$value),]
data_XY$rank = rank(data_XY$value, ties.method = "average")
table(data_XY$rank)
data_XY$rank
table(data_XY$rank)
W <- data_XY[data_XY$label=='st4',] %>% dplyr::select("rank") %>% sum
n = length(st4_ka)
m = length(st3_ka)
E_0_W <- n *(m+n+1)/2
var_0_W <- (m*n/12)*((m+n+1)-1/((m+n)*(m+n-1))*(425*(425^2-1)+19*(19^2-1)+2*(2^2-1)))
T_ <- abs((W-E_0_W)/sqrt(var_0_W))
Z_crit <- qnorm(0.025, 0, 1, lower.tail = F)
abs(T_) > Z_crit
abs(T_)
Z_crit
X <- data.frame(value = data.matrix(st4_ka), label = "st4")
Y <- data.frame(value = data.matrix(sg4_ka), label = "sg4")
data_XY <- rbind(X,Y)[order(rbind(X,Y)$value),]
data_XY$rank = rank(data_XY$value, ties.method = "average")
table(data_XY$rank)
W <- data_XY[data_XY$label=='sg4',] %>% dplyr::select("rank") %>% sum
n = length(sg4_ka)
m = length(st4_ka)
E_0_W <- n *(m+n+1)/2
var_0_W <- (m*n/12)*((m+n+1)-1/((m+n)*(m+n-1))*(138*(138^2-1)+22*(22^2-1)+3*(3^2-1)))
T_ <- abs((W-E_0_W)/sqrt(var_0_W))
Z_crit <- qnorm(0.025, 0, 1, lower.tail = F)
abs(T_) > Z_crit
abs(T_)
X <- data.frame(value = data.matrix(st3_ka), label = "st3")
Y <- data.frame(value = data.matrix(sg4_ka), label = "sg4")
data_XY <- rbind(X,Y)[order(rbind(X,Y)$value),]
data_XY$rank = rank(data_XY$value, ties.method = "average")
table(data_XY$rank)
W <- data_XY[data_XY$label=='sg4',] %>% dplyr::select("rank") %>% sum
n = length(sg4_ka)
m = length(st3_ka)
E_0_W <- n *(m+n+1)/2
var_0_W <- (m*n/12)*((m+n+1)-1/((m+n)*(m+n-1))*(453*(453^2-1)+31*(31^2-1)+3*(3^2-1)))
T_ <- abs((W-E_0_W)/sqrt(var_0_W))
Z_crit <- qnorm(0.025, 0, 1, lower.tail = F)
abs(T_) > Z_crit
st3_crash = c(nrow(dat_1[dat_1$KA==0,]),nrow(dat_1[dat_1$KA>0,]),nrow(dat_1[dat_1$KA==0,])+nrow(dat_1[dat_1$KA>0,]))
st4_crash = c(nrow(dat_2[dat_2$KA==0,]),nrow(dat_2[dat_2$KA>0,]),nrow(dat_2[dat_2$KA==0,])+nrow(dat_2[dat_2$KA>0,]))
sg4_crash = c(nrow(dat_3[dat_3$KA==0,]),nrow(dat_3[dat_3$KA>0,]),nrow(dat_3[dat_3$KA==0,])+nrow(dat_3[dat_3$KA>0,]))
total = st3_crash + st4_crash + sg4_crash
tbl <- data.frame(st3_crash,st4_crash,sg4_crash,total)
rownames(tbl) <- c('Safe',"Crash","total")
tbl
Q = 0
for (i in 1:2){
for (j in 1:3){
Q = Q + (tbl[i,j]-(tbl[i,4]*tbl[3,j]/tbl[3,4]))^2/(tbl[i,4]*tbl[3,j]/tbl[3,4])
}
}
Q >= qchisq(0.95,df=(2*1))
st3_bc = dat_1$BC
st4_bc = dat_2$BC
sg4_bc = dat_3$BC
X <- data.frame(value = data.matrix(st3_bc), label = "st3")
Y <- data.frame(value = data.matrix(st4_bc), label = "st4")
data_XY <- rbind(X,Y)[order(rbind(X,Y)$value),]
data_XY$rank = rank(data_XY$value, ties.method = "average")
table(data_XY$rank)
W <- data_XY[data_XY$label=='st4',] %>% dplyr::select("rank") %>% sum
n = length(st4_bc)
m = length(st3_bc)
E_0_W <- n *(m+n+1)/2
var_0_W <- (m*n/12)*((m+n+1)-1/((m+n)*(m+n-1))*(295*(295^2-1)+78*(78^2-1)+34*(34^2-1)+23*(23^2-1)+6*(6^2-1)+4*(4^2-1)+3*(3^2-1)))
T_ <- abs((W-E_0_W)/sqrt(var_0_W))
Z_crit <- qnorm(0.025, 0, 1, lower.tail = F)
abs(T_) > Z_crit
abs(T_)
X <- data.frame(value = data.matrix(st4_bc), label = "st4")
Y <- data.frame(value = data.matrix(sg4_bc), label = "sg4")
data_XY <- rbind(X,Y)[order(rbind(X,Y)$value),]
data_XY$rank = rank(data_XY$value, ties.method = "average")
table(data_XY$rank)
W <- data_XY[data_XY$label=='sg4',] %>% dplyr::select("rank") %>% sum
n = length(sg4_bc)
m = length(st4_bc)
E_0_W <- n *(m+n+1)/2
var_0_W <- (m*n/12)*((m+n+1)-1/((m+n)*(m+n-1))*(61*(61^2-1)+33*(33^2-1)+20*(20^2-1)+14*(14^2-1)+11*(11^2-1)+10*(10^2-1)+5*(5^2-1)+4*(4^2-1)+3*(3^2-1)))
T_ <- abs((W-E_0_W)/sqrt(var_0_W))
Z_crit <- qnorm(0.025, 0, 1, lower.tail = F)
abs(T_) > Z_crit
X <- data.frame(value = data.matrix(st3_bc), label = "st3")
Y <- data.frame(value = data.matrix(sg4_bc), label = "sg4")
data_XY <- rbind(X,Y)[order(rbind(X,Y)$value),]
data_XY$rank = rank(data_XY$value, ties.method = "average")
table(data_XY$rank)
W <- data_XY[data_XY$label=='sg4',] %>% dplyr::select("rank") %>% sum
n = length(sg4_bc)
m = length(st3_bc)
E_0_W <- n *(m+n+1)/2
var_0_W <- (m*n/12)*((m+n+1)-1/((m+n)*(m+n-1))*(297*(297^2-1)+77*(77^2-1)+44*(44^2-1)+25*(25^2-1)+15*(15^2-1)+14*(14^2-1)+5*(5^2-1)+7*(7^2-1)+2*2*(2^2-1)))
T_ <- abs((W-E_0_W)/sqrt(var_0_W))
Z_crit <- qnorm(0.025, 0, 1, lower.tail = F)
abs(T_) > Z_crit
st3_crash = c(nrow(dat_1[dat_1$BC==0,]),nrow(dat_1[dat_1$BC>0,]),nrow(dat_1[dat_1$BC==0,])+nrow(dat_1[dat_1$BC>0,]))
st4_crash = c(nrow(dat_2[dat_2$BC==0,]),nrow(dat_2[dat_2$BC>0,]),nrow(dat_2[dat_2$BC==0,])+nrow(dat_2[dat_2$BC>0,]))
sg4_crash = c(nrow(dat_3[dat_3$BC==0,]),nrow(dat_3[dat_3$BC>0,]),nrow(dat_3[dat_3$BC==0,])+nrow(dat_3[dat_3$BC>0,]))
total = st3_crash + st4_crash + sg4_crash
tbl <- data.frame(st3_crash,st4_crash,sg4_crash,total)
rownames(tbl) <- c('Safe',"Crash","total")
tbl
Q = 0
for (i in 1:2){
for (j in 1:3){
Q = Q + (tbl[i,j]-(tbl[i,4]*tbl[3,j]/tbl[3,4]))^2/(tbl[i,4]*tbl[3,j]/tbl[3,4])
}
}
Q >= qchisq(0.95,df=(2*1))st3_ka = dat_1$KA
st4_ka = dat_2$KA
st3_crash = c(nrow(dat_1[dat_1$BC==0,]),nrow(dat_1[dat_1$BC>0,]),nrow(dat_1[dat_1$BC==0,])+nrow(dat_1[dat_1$BC>0,]))
st4_crash = c(nrow(dat_2[dat_2$BC==0,]),nrow(dat_2[dat_2$BC>0,]),nrow(dat_2[dat_2$BC==0,])+nrow(dat_2[dat_2$BC>0,]))
sg4_crash = c(nrow(dat_3[dat_3$BC==0,]),nrow(dat_3[dat_3$BC>0,]),nrow(dat_3[dat_3$BC==0,])+nrow(dat_3[dat_3$BC>0,]))
total = st3_crash + st4_crash + sg4_crash
tbl <- data.frame(st3_crash,st4_crash,sg4_crash,total)
rownames(tbl) <- c('Safe',"Crash","total")
tbl
Q = 0
for (i in 1:2){
for (j in 1:3){
Q = Q + (tbl[i,j]-(tbl[i,4]*tbl[3,j]/tbl[3,4]))^2/(tbl[i,4]*tbl[3,j]/tbl[3,4])
}
}
Q >= qchisq(0.95,df=(2*1))
q
Q
View(dat_1)
View(dat_1)
cut(dat_1$SKEW_ANGLE, breaks=c(0,4,10,15), labels=c(1,2,3))
dat_1$SKEW_ANGLE
max(dat_1$SKEW_ANGLE)
cut(dat_1$SKEW_ANGLE, breaks=c(0,20,40,60,90), labels=c(1,2,3))
cut(dat_1$SKEW_ANGLE, breaks=c(0,20,40,60,90), labels=c(1,2,3,4,5))
cut(dat_1$SKEW_ANGLE, breaks=c(0,20,40,60,90), labels=c(1,2,3,4))
cut(dat_1$SKEW_ANGLE, breaks=c(0,21,41,61,91), labels=c(1,2,3,4))
cut(dat_1$SKEW_ANGLE, breaks=c(-1,21,41,61,91), labels=c(1,2,3,4))
dat_1$SKEW_ANGLE = cut(dat_1$SKEW_ANGLE, breaks=c(-1,21,41,61,91), labels=c(1,2,3,4))
View(dat_1)
dat_2$SKEW_ANGLE = cut(dat_2$SKEW_ANGLE, breaks=c(-1,21,41,61,91), labels=c(1,2,3,4))
dat_3$SKEW_ANGLE = cut(dat_3$SKEW_ANGLE, breaks=c(-1,21,41,61,91), labels=c(1,2,3,4))
View(dat_2)
st3_1_crash = c(nrow(dat_1[(dat_1$PDO==0) & (dat_1$SKEW_ANGLE==1),]),
nrow(dat_1[(dat_1$PDO>0) & (dat_1$SKEW_ANGLE==1),]),
nrow(dat_1[(dat_1$BC==0) & (dat_1$SKEW_ANGLE==1),]) + nrow(dat_1[(dat_1$BC>0) & (dat_1$SKEW_ANGLE==1),]))
st3_1_crash
##Data import
dat_1 = read.csv('./../data/3ST.csv')
dat_2 = read.csv('./../data/4ST.csv')
dat_3 = read.csv('./../data/4SG.csv')
dat_1$SKEW_ANGLE = cut(dat_1$SKEW_ANGLE, breaks=c(-1,31,61,91), labels=c(1,2,3))
dat_2$SKEW_ANGLE = cut(dat_2$SKEW_ANGLE, breaks=c(-1,31,61,91), labels=c(1,2,3))
dat_3$SKEW_ANGLE = cut(dat_3$SKEW_ANGLE, breaks=c(-1,31,61,91), labels=c(1,2,3))
View(dat_1)
total = st3_1_crash + st3_2_crash + st3_3_crash + st4_1_crash + st4_2_crash + st4_3_crash + sg4_1_crash + sg4_2_crash + sg4_3_crash
st3_1_crash = c(nrow(dat_1[(dat_1$PDO==0) & (dat_1$SKEW_ANGLE==1),]),
nrow(dat_1[(dat_1$PDO>0) & (dat_1$SKEW_ANGLE==1),]),
nrow(dat_1[(dat_1$PDO==0) & (dat_1$SKEW_ANGLE==1),]) + nrow(dat_1[(dat_1$PDO>0) & (dat_1$SKEW_ANGLE==1),]))
st3_2_crash = c(nrow(dat_1[(dat_1$PDO==0) & (dat_1$SKEW_ANGLE==2),]),
nrow(dat_1[(dat_1$PDO>0) & (dat_1$SKEW_ANGLE==2),]),
nrow(dat_1[(dat_1$PDO==0) & (dat_1$SKEW_ANGLE==2),]) + nrow(dat_1[(dat_1$PDO>0) & (dat_1$SKEW_ANGLE==2),]))
st3_3_crash = c(nrow(dat_1[(dat_1$PDO==0) & (dat_1$SKEW_ANGLE==3),]),
nrow(dat_1[(dat_1$PDO>0) & (dat_1$SKEW_ANGLE==3),]),
nrow(dat_1[(dat_1$BC==0) & (dat_1$SKEW_ANGLE==3),]) + nrow(dat_1[(dat_1$PDO>0) & (dat_1$SKEW_ANGLE==3),]))
st4_1_crash = c(nrow(dat_2[(dat_2$PDO==0) & (dat_2$SKEW_ANGLE==1),]),
nrow(dat_2[(dat_2$PDO>0) & (dat_2$SKEW_ANGLE==1),]),
nrow(dat_2[(dat_2$PDO==0) & (dat_2$SKEW_ANGLE==1),]) + nrow(dat_2[(dat_2$PDO>0) & (dat_2$SKEW_ANGLE==1),]))
st4_2_crash = c(nrow(dat_2[(dat_2$PDO==0) & (dat_2$SKEW_ANGLE==2),]),
nrow(dat_2[(dat_2$PDO>0) & (dat_2$SKEW_ANGLE==2),]),
nrow(dat_2[(dat_2$PDO==0) & (dat_2$SKEW_ANGLE==2),]) + nrow(dat_2[(dat_2$PDO>0) & (dat_2$SKEW_ANGLE==2),]))
st4_3_crash = c(nrow(dat_2[(dat_2$PDO==0) & (dat_2$SKEW_ANGLE==3),]),
nrow(dat_2[(dat_2$PDO>0) & (dat_2$SKEW_ANGLE==3),]),
nrow(dat_2[(dat_2$PDO==0) & (dat_2$SKEW_ANGLE==3),]) + nrow(dat_2[(dat_2$PDO>0) & (dat_2$SKEW_ANGLE==3),]))
sg4_1_crash = c(nrow(dat_3[(dat_3$PDO==0) & (dat_3$SKEW_ANGLE==1),]),
nrow(dat_3[(dat_3$PDO>0) & (dat_3$SKEW_ANGLE==1),]),
nrow(dat_3[(dat_3$PDO==0) & (dat_3$SKEW_ANGLE==1),]) + nrow(dat_3[(dat_3$PDO>0) & (dat_3$SKEW_ANGLE==1),]))
sg4_2_crash = c(nrow(dat_3[(dat_3$PDO==0) & (dat_3$SKEW_ANGLE==2),]),
nrow(dat_3[(dat_3$PDO>0) & (dat_3$SKEW_ANGLE==2),]),
nrow(dat_3[(dat_3$PDO==0) & (dat_3$SKEW_ANGLE==2),]) + nrow(dat_3[(dat_3$PDO>0) & (dat_3$SKEW_ANGLE==2),]))
sg4_3_crash = c(nrow(dat_3[(dat_3$PDO==0) & (dat_3$SKEW_ANGLE==3),]),
nrow(dat_3[(dat_3$PDO>0) & (dat_3$SKEW_ANGLE==3),]),
nrow(dat_3[(dat_3$PDO==0) & (dat_3$SKEW_ANGLE==3),]) + nrow(dat_3[(dat_3$PDO>0) & (dat_3$SKEW_ANGLE==3),]))
total = st3_1_crash + st3_2_crash + st3_3_crash + st4_1_crash + st4_2_crash + st4_3_crash + sg4_1_crash + sg4_2_crash + sg4_3_crash
total
tbl <- data.frame(st3_1_crash, st3_2_crash, st3_3_crash, st4_1_crash, st4_2_crash, st4_3_crash, sg4_1_crash,
sg4_2_crash, sg4_3_crash, total)
rownames(tbl) <- c('Safe',"Crash","total")
tbl
View(tbl)
View(dat_1)
View(dat_2)
View(dat_3)
st3_1_crash = c(nrow(dat_1[(dat_1$PDO==0) & (dat_1$SKEW_ANGLE==1),]),
nrow(dat_1[(dat_1$PDO>0) & (dat_1$SKEW_ANGLE==1),]),
nrow(dat_1[(dat_1$PDO==0) & (dat_1$SKEW_ANGLE==1),]) + nrow(dat_1[(dat_1$PDO>0) & (dat_1$SKEW_ANGLE==1),]))
st3_2_crash = c(nrow(dat_1[(dat_1$PDO==0) & (dat_1$SKEW_ANGLE==2),]),
nrow(dat_1[(dat_1$PDO>0) & (dat_1$SKEW_ANGLE==2),]),
nrow(dat_1[(dat_1$PDO==0) & (dat_1$SKEW_ANGLE==2),]) + nrow(dat_1[(dat_1$PDO>0) & (dat_1$SKEW_ANGLE==2),]))
st3_3_crash = c(nrow(dat_1[(dat_1$PDO==0) & (dat_1$SKEW_ANGLE==3),]),
nrow(dat_1[(dat_1$PDO>0) & (dat_1$SKEW_ANGLE==3),]),
nrow(dat_1[(dat_1$PDO==0) & (dat_1$SKEW_ANGLE==3),]) + nrow(dat_1[(dat_1$PDO>0) & (dat_1$SKEW_ANGLE==3),]))
st4_1_crash = c(nrow(dat_2[(dat_2$PDO==0) & (dat_2$SKEW_ANGLE==1),]),
nrow(dat_2[(dat_2$PDO>0) & (dat_2$SKEW_ANGLE==1),]),
nrow(dat_2[(dat_2$PDO==0) & (dat_2$SKEW_ANGLE==1),]) + nrow(dat_2[(dat_2$PDO>0) & (dat_2$SKEW_ANGLE==1),]))
st4_2_crash = c(nrow(dat_2[(dat_2$PDO==0) & (dat_2$SKEW_ANGLE==2),]),
nrow(dat_2[(dat_2$PDO>0) & (dat_2$SKEW_ANGLE==2),]),
nrow(dat_2[(dat_2$PDO==0) & (dat_2$SKEW_ANGLE==2),]) + nrow(dat_2[(dat_2$PDO>0) & (dat_2$SKEW_ANGLE==2),]))
st4_3_crash = c(nrow(dat_2[(dat_2$PDO==0) & (dat_2$SKEW_ANGLE==3),]),
nrow(dat_2[(dat_2$PDO>0) & (dat_2$SKEW_ANGLE==3),]),
nrow(dat_2[(dat_2$PDO==0) & (dat_2$SKEW_ANGLE==3),]) + nrow(dat_2[(dat_2$PDO>0) & (dat_2$SKEW_ANGLE==3),]))
sg4_1_crash = c(nrow(dat_3[(dat_3$PDO==0) & (dat_3$SKEW_ANGLE==1),]),
nrow(dat_3[(dat_3$PDO>0) & (dat_3$SKEW_ANGLE==1),]),
nrow(dat_3[(dat_3$PDO==0) & (dat_3$SKEW_ANGLE==1),]) + nrow(dat_3[(dat_3$PDO>0) & (dat_3$SKEW_ANGLE==1),]))
sg4_2_crash = c(nrow(dat_3[(dat_3$PDO==0) & (dat_3$SKEW_ANGLE==2),]),
nrow(dat_3[(dat_3$PDO>0) & (dat_3$SKEW_ANGLE==2),]),
nrow(dat_3[(dat_3$PDO==0) & (dat_3$SKEW_ANGLE==2),]) + nrow(dat_3[(dat_3$PDO>0) & (dat_3$SKEW_ANGLE==2),]))
sg4_3_crash = c(nrow(dat_3[(dat_3$PDO==0) & (dat_3$SKEW_ANGLE==3),]),
nrow(dat_3[(dat_3$PDO>0) & (dat_3$SKEW_ANGLE==3),]),
nrow(dat_3[(dat_3$PDO==0) & (dat_3$SKEW_ANGLE==3),]) + nrow(dat_3[(dat_3$PDO>0) & (dat_3$SKEW_ANGLE==3),]))
total = st3_1_crash + st3_2_crash + st3_3_crash + st4_1_crash + st4_2_crash + st4_3_crash + sg4_1_crash + sg4_2_crash + sg4_3_crash
tbl <- data.frame(st3_1_crash, st3_2_crash, st3_3_crash, st4_1_crash, st4_2_crash, st4_3_crash, sg4_1_crash,
sg4_2_crash, sg4_3_crash, total)
rownames(tbl) <- c('Safe',"Crash","total")
tbl
Q = 0
for (i in 1:2){
for (j in 1:9){
Q = Q + (tbl[i,j]-(tbl[i,10]*tbl[3,j]/tbl[3,10]))^2/(tbl[i,10]*tbl[3,j]/tbl[3,10])
}
}
Q
tbl[3,10]
tbl[i,10]
tbl[3,j]
Q = 0
for (i in 1:2){
for (j in 1:9){
Q = Q + (tbl[i,j]-(tbl[i,10]*tbl[3,j]/tbl[3,10]))^2/(tbl[i,10]*tbl[3,j]/tbl[3,10])
}
}
Q
Q = 0
i=1
j=1
Q = Q + (tbl[i,j]-(tbl[i,10]*tbl[3,j]/tbl[3,10]))^2/(tbl[i,10]*tbl[3,j]/tbl[3,10])
j=2
Q = Q + (tbl[i,j]-(tbl[i,10]*tbl[3,j]/tbl[3,10]))^2/(tbl[i,10]*tbl[3,j]/tbl[3,10])
j=3
j=3
Q = Q + (tbl[i,j]-(tbl[i,10]*tbl[3,j]/tbl[3,10]))^2/(tbl[i,10]*tbl[3,j]/tbl[3,10])
j=4
Q = Q + (tbl[i,j]-(tbl[i,10]*tbl[3,j]/tbl[3,10]))^2/(tbl[i,10]*tbl[3,j]/tbl[3,10])
j=5
Q = Q + (tbl[i,j]-(tbl[i,10]*tbl[3,j]/tbl[3,10]))^2/(tbl[i,10]*tbl[3,j]/tbl[3,10])
j=6
Q = Q + (tbl[i,j]-(tbl[i,10]*tbl[3,j]/tbl[3,10]))^2/(tbl[i,10]*tbl[3,j]/tbl[3,10])
tbl
st3_1_crash = c(nrow(dat_1[(dat_1$PDO==0) & (dat_1$SKEW_ANGLE==1),]),
nrow(dat_1[(dat_1$PDO>0) & (dat_1$SKEW_ANGLE==1),]),
nrow(dat_1[(dat_1$PDO==0) & (dat_1$SKEW_ANGLE==1),]) + nrow(dat_1[(dat_1$PDO>0) & (dat_1$SKEW_ANGLE==1),]))
st3_2_crash = c(nrow(dat_1[(dat_1$PDO==0) & (dat_1$SKEW_ANGLE==2),]),
nrow(dat_1[(dat_1$PDO>0) & (dat_1$SKEW_ANGLE==2),]),
nrow(dat_1[(dat_1$PDO==0) & (dat_1$SKEW_ANGLE==2),]) + nrow(dat_1[(dat_1$PDO>0) & (dat_1$SKEW_ANGLE==2),]))
st3_3_crash = c(nrow(dat_1[(dat_1$PDO==0) & (dat_1$SKEW_ANGLE==3),]),
nrow(dat_1[(dat_1$PDO>0) & (dat_1$SKEW_ANGLE==3),]),
nrow(dat_1[(dat_1$PDO==0) & (dat_1$SKEW_ANGLE==3),]) + nrow(dat_1[(dat_1$PDO>0) & (dat_1$SKEW_ANGLE==3),]))
st4_1_crash = c(nrow(dat_2[(dat_2$PDO==0) & (dat_2$SKEW_ANGLE==1),]),
nrow(dat_2[(dat_2$PDO>0) & (dat_2$SKEW_ANGLE==1),]),
nrow(dat_2[(dat_2$PDO==0) & (dat_2$SKEW_ANGLE==1),]) + nrow(dat_2[(dat_2$PDO>0) & (dat_2$SKEW_ANGLE==1),]))
st4_2_crash = c(nrow(dat_2[(dat_2$PDO==0) & (dat_2$SKEW_ANGLE==2),]),
nrow(dat_2[(dat_2$PDO>0) & (dat_2$SKEW_ANGLE==2),]),
nrow(dat_2[(dat_2$PDO==0) & (dat_2$SKEW_ANGLE==2),]) + nrow(dat_2[(dat_2$PDO>0) & (dat_2$SKEW_ANGLE==2),]))
st4_3_crash = c(nrow(dat_2[(dat_2$PDO==0) & (dat_2$SKEW_ANGLE==3),]),
nrow(dat_2[(dat_2$PDO>0) & (dat_2$SKEW_ANGLE==3),]),
nrow(dat_2[(dat_2$PDO==0) & (dat_2$SKEW_ANGLE==3),]) + nrow(dat_2[(dat_2$PDO>0) & (dat_2$SKEW_ANGLE==3),]))
sg4_1_crash = c(nrow(dat_3[(dat_3$PDO==0) & (dat_3$SKEW_ANGLE==1),]),
nrow(dat_3[(dat_3$PDO>0) & (dat_3$SKEW_ANGLE==1),]),
nrow(dat_3[(dat_3$PDO==0) & (dat_3$SKEW_ANGLE==1),]) + nrow(dat_3[(dat_3$PDO>0) & (dat_3$SKEW_ANGLE==1),]))
sg4_2_crash = c(nrow(dat_3[(dat_3$PDO==0) & (dat_3$SKEW_ANGLE==2),]),
nrow(dat_3[(dat_3$PDO>0) & (dat_3$SKEW_ANGLE==2),]),
nrow(dat_3[(dat_3$PDO==0) & (dat_3$SKEW_ANGLE==2),]) + nrow(dat_3[(dat_3$PDO>0) & (dat_3$SKEW_ANGLE==2),]))
sg4_3_crash = c(nrow(dat_3[(dat_3$PDO==0) & (dat_3$SKEW_ANGLE==3),]),
nrow(dat_3[(dat_3$PDO>0) & (dat_3$SKEW_ANGLE==3),]),
nrow(dat_3[(dat_3$PDO==0) & (dat_3$SKEW_ANGLE==3),]) + nrow(dat_3[(dat_3$PDO>0) & (dat_3$SKEW_ANGLE==3),]))
total = st3_1_crash + st3_2_crash + st3_3_crash + st4_1_crash + st4_2_crash + st4_3_crash + sg4_1_crash + sg4_2_crash + sg4_3_crash
tbl <- data.frame(st3_1_crash, st3_2_crash, st3_3_crash, st4_1_crash, st4_2_crash, st4_3_crash, sg4_1_crash,
sg4_2_crash, total)
# we've drop sg4_3_crash, as its size = 0.
rownames(tbl) <- c('Safe',"Crash","total")
tbl
Q = 0
for (i in 1:2){
for (j in 1:8){
Q = Q + (tbl[i,j]-(tbl[i,10]*tbl[3,j]/tbl[3,10]))^2/(tbl[i,10]*tbl[3,j]/tbl[3,10])
}
}
Q
i=1
j=1
Q =0
Q = Q + (tbl[i,j]-(tbl[i,10]*tbl[3,j]/tbl[3,10]))^2/(tbl[i,10]*tbl[3,j]/tbl[3,10])
Q = 0
tbl[i,j]
(tbl[i,10]*tbl[3,j]/tbl[3,10]))^2
(tbl[i,10]*tbl[3,j]/tbl[3,10])
tbl[i,10]
Q = 0
for (i in 1:2){
for (j in 1:8){
Q = Q + (tbl[i,j]-(tbl[i,9]*tbl[3,j]/tbl[3,9]))^2/(tbl[i,9]*tbl[3,j]/tbl[3,9])
}
}
Q >= qchisq(0.95,df=(2*1))
st3_0_crash = c(nrow(dat_1[(dat_1$PDO==0) & (dat_1$LIGHTING==0),]),
nrow(dat_1[(dat_1$PDO>0) & (dat_1$LIGHTING==0),]),
nrow(dat_1[(dat_1$PDO==0) & (dat_1$LIGHTING==0),]) + nrow(dat_1[(dat_1$PDO>0) & (dat_1$LIGHTING==0),]))
st3_1_crash = c(nrow(dat_1[(dat_1$PDO==0) & (dat_1$LIGHTING==1),]),
nrow(dat_1[(dat_1$PDO>0) & (dat_1$LIGHTING==1),]),
nrow(dat_1[(dat_1$PDO==0) & (dat_1$LIGHTING==1),]) + nrow(dat_1[(dat_1$PDO>0) & (dat_1$LIGHTING==1),]))
st4_0_crash = c(nrow(dat_2[(dat_2$PDO==0) & (dat_2$LIGHTING==0),]),
nrow(dat_2[(dat_2$PDO>0) & (dat_2$LIGHTING==0),]),
nrow(dat_2[(dat_2$PDO==0) & (dat_2$LIGHTING==0),]) + nrow(dat_2[(dat_2$PDO>0) & (dat_2$LIGHTING==0),]))
st4_1_crash = c(nrow(dat_2[(dat_2$PDO==0) & (dat_2$LIGHTING==1),]),
nrow(dat_2[(dat_2$PDO>0) & (dat_2$LIGHTING==1),]),
nrow(dat_2[(dat_2$PDO==0) & (dat_2$LIGHTING==1),]) + nrow(dat_2[(dat_2$PDO>0) & (dat_2$LIGHTING==1),]))
sg4_0_crash = c(nrow(dat_3[(dat_3$PDO==0) & (dat_3$LIGHTING==0),]),
nrow(dat_3[(dat_3$PDO>0) & (dat_3$LIGHTING==0),]),
nrow(dat_3[(dat_3$PDO==0) & (dat_3$LIGHTING==0),]) + nrow(dat_3[(dat_3$PDO>0) & (dat_3$LIGHTING==0),]))
sg4_1_crash = c(nrow(dat_3[(dat_3$PDO==0) & (dat_3$LIGHTING==1),]),
nrow(dat_3[(dat_3$PDO>0) & (dat_3$LIGHTING==1),]),
nrow(dat_3[(dat_3$PDO==0) & (dat_3$LIGHTING==1),]) + nrow(dat_3[(dat_3$PDO>0) & (dat_3$LIGHTING==1),]))
total = st3_0_crash + st3_1_crash + st4_0_crash + st4_1_crash + sg4_0_crash + sg4_1_crash
tbl <- data.frame(st3_0_crash, st3_1_crash, st4_0_crash, st4_1_crash, sg4_0_crash, sg4_1_crash, total)
tbl
rownames(tbl) <- c('Safe',"Crash","total")
tbl
Q = 0
for (i in 1:2){
for (j in 1:6){
Q = Q + (tbl[i,j]-(tbl[i,7]*tbl[3,j]/tbl[3,7]))^2/(tbl[i,7]*tbl[3,j]/tbl[3,7])
}
}
Q >= qchisq(0.95,df=(2*1))
Q
View(tbl)
st3_00_crash = c(nrow(dat_1[(dat_1$PDO==0) & (dat_1$APPROACH_LEFTTURN==0) & (dat_1$APPROACH_RIGHTTURN==0),]),
nrow(dat_1[(dat_1$PDO>0) & (dat_1$APPROACH_LEFTTURN==0) & (dat_1$APPROACH_RIGHTTURN==0),]),
nrow(dat_1[(dat_1$PDO==0) & (dat_1$APPROACH_LEFTTURN==0) & (dat_1$APPROACH_RIGHTTURN==0),]) + nrow(dat_1[(dat_1$PDO>0) & (dat_1$APPROACH_LEFTTURN==0) & (dat_1$APPROACH_RIGHTTURN==0),]))
st3_10_crash = c(nrow(dat_1[(dat_1$PDO==0) & (dat_1$APPROACH_LEFTTURN==1) & (dat_1$APPROACH_RIGHTTURN==0),]),
nrow(dat_1[(dat_1$PDO>0) & (dat_1$APPROACH_LEFTTURN==1) & (dat_1$APPROACH_RIGHTTURN==0),]),
nrow(dat_1[(dat_1$PDO==0) & (dat_1$APPROACH_LEFTTURN==1) & (dat_1$APPROACH_RIGHTTURN==0),]) + nrow(dat_1[(dat_1$PDO>0) & (dat_1$APPROACH_LEFTTURN==1) & (dat_1$APPROACH_RIGHTTURN==0),]))
st3_01_crash = c(nrow(dat_1[(dat_1$PDO==0) & (dat_1$APPROACH_LEFTTURN==0) & (dat_1$APPROACH_RIGHTTURN==1),]),
nrow(dat_1[(dat_1$PDO>0) & (dat_1$APPROACH_LEFTTURN==0) & (dat_1$APPROACH_RIGHTTURN==1),]),
nrow(dat_1[(dat_1$PDO==0) & (dat_1$APPROACH_LEFTTURN==0) & (dat_1$APPROACH_RIGHTTURN==1),]) + nrow(dat_1[(dat_1$PDO>0) & (dat_1$APPROACH_LEFTTURN==0) & (dat_1$APPROACH_RIGHTTURN==1),]))
st3_11_crash = c(nrow(dat_1[(dat_1$PDO==0) & (dat_1$APPROACH_LEFTTURN==1) & (dat_1$APPROACH_RIGHTTURN==1),]),
nrow(dat_1[(dat_1$PDO>0) & (dat_1$APPROACH_LEFTTURN==1) & (dat_1$APPROACH_RIGHTTURN==1),]),
nrow(dat_1[(dat_1$PDO==0) & (dat_1$APPROACH_LEFTTURN==1) & (dat_1$APPROACH_RIGHTTURN==1),]) + nrow(dat_1[(dat_1$PDO>0) & (dat_1$APPROACH_LEFTTURN==1) & (dat_1$APPROACH_RIGHTTURN==1),]))
st4_00_crash = c(nrow(dat_2[(dat_2$PDO==0) & (dat_2$APPROACH_LEFTTURN==0) & (dat_2$APPROACH_RIGHTTURN==0),]),
nrow(dat_2[(dat_2$PDO>0) & (dat_2$APPROACH_LEFTTURN==0) & (dat_2$APPROACH_RIGHTTURN==0),]),
nrow(dat_2[(dat_2$PDO==0) & (dat_2$APPROACH_LEFTTURN==0) & (dat_2$APPROACH_RIGHTTURN==0),]) + nrow(dat_2[(dat_2$PDO>0) & (dat_2$APPROACH_LEFTTURN==0) & (dat_2$APPROACH_RIGHTTURN==0),]))
st4_10_crash = c(nrow(dat_2[(dat_2$PDO==0) & (dat_2$APPROACH_LEFTTURN==1) & (dat_2$APPROACH_RIGHTTURN==0),]),
nrow(dat_2[(dat_2$PDO>0) & (dat_2$APPROACH_LEFTTURN==1) & (dat_2$APPROACH_RIGHTTURN==0),]),
nrow(dat_2[(dat_2$PDO==0) & (dat_2$APPROACH_LEFTTURN==1) & (dat_2$APPROACH_RIGHTTURN==0),]) + nrow(dat_2[(dat_2$PDO>0) & (dat_2$APPROACH_LEFTTURN==1) & (dat_2$APPROACH_RIGHTTURN==0),]))
st4_01_crash = c(nrow(dat_2[(dat_2$PDO==0) & (dat_2$APPROACH_LEFTTURN==0) & (dat_2$APPROACH_RIGHTTURN==1),]),
nrow(dat_2[(dat_2$PDO>0) & (dat_2$APPROACH_LEFTTURN==0) & (dat_2$APPROACH_RIGHTTURN==1),]),
nrow(dat_2[(dat_2$PDO==0) & (dat_2$APPROACH_LEFTTURN==0) & (dat_2$APPROACH_RIGHTTURN==1),]) + nrow(dat_2[(dat_2$PDO>0) & (dat_2$APPROACH_LEFTTURN==0) & (dat_2$APPROACH_RIGHTTURN==1),]))
st4_11_crash = c(nrow(dat_2[(dat_2$PDO==0) & (dat_2$APPROACH_LEFTTURN==1) & (dat_2$APPROACH_RIGHTTURN==1),]),
nrow(dat_2[(dat_2$PDO>0) & (dat_2$APPROACH_LEFTTURN==1) & (dat_2$APPROACH_RIGHTTURN==1),]),
nrow(dat_2[(dat_2$PDO==0) & (dat_2$APPROACH_LEFTTURN==1) & (dat_2$APPROACH_RIGHTTURN==1),]) + nrow(dat_2[(dat_2$PDO>0) & (dat_2$APPROACH_LEFTTURN==1) & (dat_2$APPROACH_RIGHTTURN==1),]))
sg4_00_crash = c(nrow(dat_3[(dat_3$PDO==0) & (dat_3$APPROACH_LEFTTURN==0) & (dat_3$APPROACH_RIGHTTURN==0),]),
nrow(dat_3[(dat_3$PDO>0) & (dat_3$APPROACH_LEFTTURN==0) & (dat_3$APPROACH_RIGHTTURN==0),]),
nrow(dat_3[(dat_3$PDO==0) & (dat_3$APPROACH_LEFTTURN==0) & (dat_3$APPROACH_RIGHTTURN==0),]) + nrow(dat_3[(dat_3$PDO>0) & (dat_3$APPROACH_LEFTTURN==0) & (dat_3$APPROACH_RIGHTTURN==0),]))
sg4_10_crash = c(nrow(dat_3[(dat_3$PDO==0) & (dat_3$APPROACH_LEFTTURN==1) & (dat_3$APPROACH_RIGHTTURN==0),]),
nrow(dat_3[(dat_3$PDO>0) & (dat_3$APPROACH_LEFTTURN==1) & (dat_3$APPROACH_RIGHTTURN==0),]),
nrow(dat_3[(dat_3$PDO==0) & (dat_3$APPROACH_LEFTTURN==1) & (dat_3$APPROACH_RIGHTTURN==0),]) + nrow(dat_3[(dat_3$PDO>0) & (dat_3$APPROACH_LEFTTURN==1) & (dat_3$APPROACH_RIGHTTURN==0),]))
sg4_01_crash = c(nrow(dat_3[(dat_3$PDO==0) & (dat_3$APPROACH_LEFTTURN==0) & (dat_3$APPROACH_RIGHTTURN==1),]),
nrow(dat_3[(dat_3$PDO>0) & (dat_3$APPROACH_LEFTTURN==0) & (dat_3$APPROACH_RIGHTTURN==1),]),
nrow(dat_3[(dat_3$PDO==0) & (dat_3$APPROACH_LEFTTURN==0) & (dat_3$APPROACH_RIGHTTURN==1),]) + nrow(dat_3[(dat_3$PDO>0) & (dat_3$APPROACH_LEFTTURN==0) & (dat_3$APPROACH_RIGHTTURN==1),]))
sg4_11_crash = c(nrow(dat_3[(dat_3$PDO==0) & (dat_3$APPROACH_LEFTTURN==1) & (dat_3$APPROACH_RIGHTTURN==1),]),
nrow(dat_3[(dat_3$PDO>0) & (dat_3$APPROACH_LEFTTURN==1) & (dat_3$APPROACH_RIGHTTURN==1),]),
nrow(dat_3[(dat_3$PDO==0) & (dat_3$APPROACH_LEFTTURN==1) & (dat_3$APPROACH_RIGHTTURN==1),]) + nrow(dat_3[(dat_3$PDO>0) & (dat_3$APPROACH_LEFTTURN==1) & (dat_3$APPROACH_RIGHTTURN==1),]))
tbl <- data.frame(st3_00_crash,st3_01_crash,st3_10_crash,st3_11_crash,st4_00_crash,st4_01_crash,st4_10_crash,st4_11_crash,sg4_00_crash,sg4_01_crash,sg4_10_crash,sg4_11_crash,total)
tbl
tbl <- data.frame(st3_00_crash,st3_01_crash,st3_10_crash,st3_11_crash,st4_00_crash,st4_10_crash,st4_11_crash,sg4_00_crash,sg4_01_crash,sg4_10_crash,sg4_11_crash,total)
tbl
rownames(tbl) <- c('Safe',"Crash","total")
tbl
Q = 0
for (i in 1:2){
for (j in 1:11){
Q = Q + (tbl[i,j]-(tbl[i,12]*tbl[3,j]/tbl[3,12]))^2/(tbl[i,12]*tbl[3,j]/tbl[3,12])
}
}
Q
Q >= qchisq(0.95,df=(2*1))
View(dat_1)
dat_1[dat_1$PDO>0,]
dat_1[dat_1$PDO>0,dat_1$AADT_MAJOR]
dat_1[dat_1$PDO>0,c("AADT_MAJOR")]
st3_aadt_m_pdonocrash = dat_1[dat_1$PDO==0,c("AADT_MAJOR")]
st3_aadt_m_pdonocrash
st3_aadt_m_pdocrash = dat_1[dat_1$PDO>0,c("AADT_MAJOR")]
st3_aadt_m_pdonocrash = dat_1[dat_1$PDO==0,c("AADT_MAJOR")]
st4_aadt_m_pdocrash = dat_2[dat_2$PDO>0,c("AADT_MAJOR")]
st3_aadt_m_pdonocrash = dat_2[dat_2$PDO==0,c("AADT_MAJOR")]
sg4_aadt_m_pdocrash = dat_3[dat_3$PDO>0,c("AADT_MAJOR")]
sg4_aadt_m_pdonocrash = dat_3[dat_3$PDO==0,c("AADT_MAJOR")]
sg4_aadt_m_pdocrash
sg4_aadt_m_pdonocrash
st3_aadt_m_pdocrash = dat_1[dat_1$PDO>0,c("AADT_MAJOR")]
st3_aadt_m_pdonocrash = dat_1[dat_1$PDO==0,c("AADT_MAJOR")]
st4_aadt_m_pdocrash = dat_2[dat_2$PDO>0,c("AADT_MAJOR")]
st4_aadt_m_pdonocrash = dat_2[dat_2$PDO==0,c("AADT_MAJOR")]
sg4_aadt_m_pdocrash = dat_3[dat_3$PDO>0,c("AADT_MAJOR")]
sg4_aadt_m_pdonocrash = dat_3[dat_3$PDO==0,c("AADT_MAJOR")]
### Comparing st3:
shapiro.test(st3_aadt_m_pdocrash)
shapiro.test(st3_aadt_m_pdonocrash)
### Comparing st3:
shapiro.test(st3_aadt_m_pdocrash)
shapiro.test(st3_aadt_m_pdonocrash)
shapiro.test(st4_aadt_m_pdocrash)
shapiro.test(st4_aadt_m_pdonocrash)
shapiro.test(sg4_aadt_m_pdocrash)
shapiro.test(sg4_aadt_m_pdonocrash)
sg4_aadt_m_pdonocrash
sd(st3_aadt_m_pdocrash)
sd(st3_aadt_m_pdonocrash)
sd(st4_aadt_m_pdocrash)
sd(st4_aadt_m_pdonocrash)
sd(sg4_aadt_m_pdocrash)
sd(sg4_aadt_m_pdonocrash)
X <- data.frame(value = data.matrix(st3_aadt_m_pdonocrash), label = "nocrash")
Y <- data.frame(value = data.matrix(st3_aadt_m_pdocrash), label = "crash")
data_XY <- rbind(X,Y)[order(rbind(X,Y)$value),]
data_XY$rank = rank(data_XY$value, ties.method = "average")
table(data_XY$rank)
table(data_XY$rank) != 1
table(data_XY$rank)[table(data_XY$rank)!= 1]
n = length(st3_aadt_m_pdocrash)
W <- data_XY[data_XY$label=='crash',] %>% dplyr::select("rank") %>% sum
n = length(st3_aadt_m_pdocrash)
m = length(st3_aadt_m_pdonocrash)
E_0_W <- n *(m+n+1)/2
E_0_W
var_0_W <- (m*n/12)*((m+n+1)-1/((m+n)*(m+n-1))*(35*2*(2^2-1)+18*3*(3^2-1)+9*4*(4^2-1)+10*5*(5^2-1)+6*6*(6^2-1)+3*7*(7^2-1)+2*9*(9^2-1)+4*10*(10^2-1)+12*(12^2-1)))
T_ <- abs((W-E_0_W)/sqrt(var_0_W))
Z_crit <- qnorm(0.025, 0, 1, lower.tail = F)
abs(T_) > Z_crit
abs(T_)
X <- data.frame(value = data.matrix(st4_aadt_m_pdonocrash), label = "nocrash")
Y <- data.frame(value = data.matrix(st4_aadt_m_pdocrash), label = "crash")
data_XY <- rbind(X,Y)[order(rbind(X,Y)$value),]
data_XY$rank = rank(data_XY$value, ties.method = "average")
table(data_XY$rank)[table(data_XY$rank)!= 1]
W <- data_XY[data_XY$label=='crash',] %>% dplyr::select("rank") %>% sum
data_XY
table(data_XY$rank)[table(data_XY$rank)!= 1]
table(data_XY$rank)[table(data_XY$rank)!= 1]
W <- data_XY[data_XY$label=='crash',] %>% dplyr::select("rank") %>% sum
n = length(st4_aadt_m_pdocrash)
m = length(st4_aadt_m_pdonocrash)
E_0_W <- n *(m+n+1)/2
var_0_W <- (m*n/12)*((m+n+1)-1/((m+n)*(m+n-1))*(13*2*(2^2-1)+2*3*(3^2-1)))
T_ <- abs((W-E_0_W)/sqrt(var_0_W))
Z_crit <- qnorm(0.025, 0, 1, lower.tail = F)
abs(T_) > Z_crit
X <- data.frame(value = data.matrix(sg4_aadt_m_pdonocrash), label = "nocrash")
Y <- data.frame(value = data.matrix(sg4_aadt_m_pdocrash), label = "crash")
data_XY <- rbind(X,Y)[order(rbind(X,Y)$value),]
data_XY$rank = rank(data_XY$value, ties.method = "average")
table(data_XY$rank)[table(data_XY$rank)!= 1]
W <- data_XY[data_XY$label=='crash',] %>% dplyr::select("rank") %>% sum
n = length(sg4_aadt_m_pdocrash)
m = length(sg4_aadt_m_pdonocrash)
E_0_W <- n *(m+n+1)/2
var_0_W <- (m*n/12)*((m+n+1)-1/((m+n)*(m+n-1))*(21*2*(2^2-1)+3*(3^2-1)+4(4^2-1)))
T_ <- abs((W-E_0_W)/sqrt(var_0_W))
var_0_W <- (m*n/12)*((m+n+1)-1/((m+n)*(m+n-1))*(21*2*(2^2-1)+3*(3^2-1)+4*(4^2-1)))
T_ <- abs((W-E_0_W)/sqrt(var_0_W))
Z_crit <- qnorm(0.025, 0, 1, lower.tail = F)
abs(T_) > Z_crit
